{% extends 'base.html' %}
{% load static %}
{% load mainapp_tags %}

{% block  header %}
    {% include 'header.html' %}
{% endblock %}

{% block title %}Список аналитики устройств вывода{% endblock %}
{% block content %}
<div class="container">

    <h3 class="List-title">Список устройств вывода</h3>
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade in show" role="alert">
                {{ message|safe }}
                <button class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}
    {% endif %}

<div class="row">
            <div class="col">
                <p class="count">Общее колличество: {{ total_count }}
                </p>
            </div>
        </div>

        <div class="row">
            <div class="col">

                <form action="" method="GET" class="form-inline my-4">

                    <input class="form-control mr-2" name="serialNumber" type="search" placeholder="По серийному номеру"
                           aria-label="Search">


                    <select name="control_period" class="custom-select mr-2" style="width: auto !important;">
                        <option value="" selected="">Контрольный период диагностики</option>
                        {% for control_period in control_periods %}
                            <option value="{{ control_period.pk }}">{{ control_period.name }}</option>
                        {% endfor %}
                    </select>

                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Показать</button>
                </form>
            </div>
        </div>

    <form action="{% url 'export_output_devices_analytics' %}" method="GET" class="form-inline">
        <button class="btn btn-outline-primary my-2 my-sm-0" type="submit">
            Выгрузить аналитику
        </button>
    </form>
    <table class="table">
        <thead>
        <tr>
            <th>Серийный номер</th>
            <th>Дата последней диагностики</th>
            <th>Дата плановой диагности</th>
            <th>Период диагностикики</th>
            <th>Осталось дней</th>
            <th scope="col">Действие</th>
        </tr>

        {% for printer in printers %}
            <tbody>
            <tr>
                <td><a href="{% url 'printer_detail' pk=printer.pk %}">
                    {{ printer.serialNumber }}</a>
                </td>
                <td>
                    {% if printer.date_of_last_diagnostics %}
                        {{ printer.date_of_last_diagnostics|date:"d.m.Y" }}
                    {% else %}
                        -----
                    {% endif %}
                </td>
                <td>
                    {% if printer.date_of_planned_diagnostics %}
                        {{ printer.date_of_planned_diagnostics|date:"d.m.Y" }}
                    {% else %}
                        -----
                    {% endif %}
                </td>
                <td>
                    {% if printer.period_of_product_diagnostics %}
                        {{ printer.period_of_product_diagnostics.period.days }}
                    {% else %}
                        -----
                    {% endif %}
                </td>
                <td>
                    {% if printer.days_remain_to_diagnostics.days %}
                        {% test_days_to_diagnostics_remain days=printer.days_remain_to_diagnostics.days period=printer.period_of_product_diagnostics.period.days as badge %}
                        <span class="badge {{ badge }}">
                        {{ printer.days_remain_to_diagnostics.days }}
                        </span>
                    {% else %}
                        -----
                    {% endif %}
                </td>
                <td><a href="{% url 'printer_analyz_update' pk=printer.pk %}">Изменить</a></td>
            </tr>
            </tbody>
        {% endfor %}

            {% for monitor in monitors %}
            <tbody>
            <tr>
                <td><a href="{% url 'monitorDetail' pk=monitor.pk %}">
                    {{ monitor.serialNumber }}</a>
                </td>
                <td>
                    {% if monitor.date_of_last_diagnostics %}
                        {{ monitor.date_of_last_diagnostics|date:"d.m.Y" }}
                    {% else %}
                        -----
                    {% endif %}
                </td>
                <td>
                    {% if monitor.date_of_planned_diagnostics %}
                        {{ monitor.date_of_planned_diagnostics|date:"d.m.Y" }}
                    {% else %}
                        -----
                    {% endif %}
                </td>
                <td>
                    {% if monitor.period_of_product_diagnostics %}
                        {{ monitor.period_of_product_diagnostics.period.days }}
                    {% else %}
                        -----
                    {% endif %}
                </td>
                <td>
                    {% if monitor.days_remain_to_diagnostics.days %}
                        {% test_days_to_diagnostics_remain days=monitor.days_remain_to_diagnostics.days period=monitor.period_of_product_diagnostics.period.days as badge %}
                        <span class="badge {{ badge }}">
                        {{ monitor.days_remain_to_diagnostics.days }}
                        </span>
                    {% else %}
                        -----
                    {% endif %}
                </td>
                <td><a href="">Изменить</a></td>
            </tr>
            </tbody>
        {% endfor %}
    </table>
</div>
{% endblock %}
{% block footer %}
{% endblock %}